Dealing with more functions and nested loops, wishing for the best
